<?xml version="1.0" encoding="utf-8"?>
<mx:Module  xmlns:mx="http://www.adobe.com/2006/mxml"   layout="vertical" width="100%"  creationComplete="init();" height="100%" xmlns:mutiComboBox="system.component.mutiComboBox.*" xmlns:component="system.component.*" currentState="list">
	<mx:StringValidator id="aClass_stringValidator" source="{aClass}" property="text" required="true" requiredFieldError="班级不能为空"/>
	<mx:DateValidator  id="aCourseDate_stringValidator" source="{aCourseDate}" property="text"  required="true" requiredFieldError="原课时不能为空"/>
	<mx:StringValidator id="aCourseSection_stringValidator" source="{aCourseSection.myText}" property="text" required="true" requiredFieldError="课时节次不能为空"/>
	<mx:DateValidator  id="adjustDate_stringValidator" source="{adjustDate}" property="text" required="true" requiredFieldError="意向时间不能为空"/>
	<mx:StringValidator id="adjustTeacher_stringValidator" source="{adjustTeacher}" property="text" required="true" requiredFieldError="意向老师不能为空"/>	
	
	<mx:states>
		<mx:State name="list">           
			<mx:RemoveChild target="{addPanel}"/>
		</mx:State>
		<mx:State name="add">           
			<mx:RemoveChild target="{listPanel}"/>
		</mx:State>
	</mx:states>
	<mx:transitions>
		
		<mx:Transition id="myTransition1" fromState="list" toState="add" >
			
			<mx:Parallel id="t1" target="{addPanel}" >
				
				<mx:WipeLeft duration="800">
					
				</mx:WipeLeft>
			</mx:Parallel>
			
			
		</mx:Transition>
		<mx:Transition id="myTransition2" fromState="add" toState="list" >
			
			<mx:Parallel id="t2" target="{listPanel}" >
				
				<mx:WipeRight duration="800">
					
				</mx:WipeRight>
			</mx:Parallel>
			
			
		</mx:Transition>
		
		
	</mx:transitions>
	<mx:Script> 
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.events.ListEvent;
			
			import system.component.AutoComplete;
			import system.component.mutiComboBox.MyDropList;
			import system.utils.CommonUtils;
			import mx.containers.FormItem;
			import mx.controls.Alert;
			import mx.validators.Validator;
			import mx.events.ValidationResultEvent;
			private var validatorArr:Array;
			
			[Embed(source="../WebContent/resources/common/tools/button_add_icon.png")]
			private const button_add:Class;
			[Embed(source="../WebContent/resources/common/tools/button_delete_icon.png")]
			private const button_delete:Class;
			public const applyTypes:ArrayCollection = new ArrayCollection( 
				[	{label:"调课", data:"调课"},  
					{label:"代课", data:"代课"} ]); 
			public const courseTypes:ArrayCollection = new ArrayCollection( 
				[	{label:"语文", data:"语文"},  
					{label:"数学", data:"数学"}, 
					{label:"英语", data:"英语"},
					{label:"化学", data:"化学"},
					{label:"体育", data:"体育"},
					{label:"生物", data:"生物"},
					{label:"物理", data:"物理"},
					{label:"地理", data:"地理"},
					{label:"音乐", data:"音乐"},
					{label:"电脑", data:"电脑"},
					{label:"其他", data:"其他"}]);
			public const courseSections:ArrayCollection = new ArrayCollection([{label:"全选",value:"all",selected:false},
				{label:"第一节",value:"1",selected:false},
				{label:"第二节",value:"2",selected:false},
				{label:"第三节",value:"3",selected:false},
				{label:"第四节",value:"4",selected:false},
				{label:"第五节",value:"5",selected:false},
				{label:"第六节",value:"6",selected:false},
				{label:"第七节",value:"7",selected:false},
				{label:"第八节",value:"8",selected:false},
				{label:"第九节",value:"9",selected:false}
				
			]);
			
			private function init():void {	
				validatorArr = new Array();
				validatorArr.push(aClass_stringValidator);
				validatorArr.push(aCourseDate_stringValidator);
				validatorArr.push(aCourseSection_stringValidator);
				validatorArr.push(adjustDate_stringValidator);
				validatorArr.push(adjustTeacher_stringValidator);
				applyType.dataProvider=applyTypes;
			}
			public function cancleApply(id:String):void{
				
			}
			public function enterEdit(id:String):void{
				
			}
			public function detailApply(id:String):void{
			
			}
			protected function removeItem_clickHandler(event:MouseEvent):void{
				var target:LinkButton=event.target as LinkButton;
				var row1:GridRow=target.owner as GridRow;
				var row2:GridRow=row1.owner as GridRow;
				container.removeElement(row2);
				container.removeElement(row1);
			}
			protected function addItem_clickHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub
			
				var row1:GridRow=new GridRow();
				
				var rowItem_class:GridItem=new GridItem();
				var aClass:Label=new Label();
				aClass.text="班级";
				aClass.width=60;
				aClass.setStyle("textAlign","right");
				rowItem_class.addElement(aClass);
				row1.addElement(rowItem_class);
				var rowItem_classInput:GridItem=new GridItem();
				var aClassInut:TextInput=new TextInput();
				aClassInut.name="aClass";
				aClassInut.id="aClass";
				aClassInut.width=120;
				rowItem_classInput.addElement(aClassInut);
				row1.addElement(rowItem_classInput);

				var rowItem_course:GridItem=new GridItem();
				var course:Label=new Label();
				course.text="科目";
				course.width=60;
				course.setStyle("textAlign","right");
				rowItem_course.addElement(course);
				row1.addElement(rowItem_course);
				var rowItem_courseCombo:GridItem=new GridItem();
				var courseComb:ComboBox=new ComboBox();
				courseComb.dataProvider=new ArrayCollection(courseTypes.toArray());
				courseComb.width=120;
				courseComb.name="aCourse";
				courseComb.id="aCourse";
				rowItem_courseCombo.addElement(courseComb);
				row1.addElement(rowItem_courseCombo);
				
				var rowItem_preClassTime:GridItem=new GridItem();
				var preClassTime:Label=new Label();
				preClassTime.text="原课时";
				preClassTime.width=60;
				preClassTime.setStyle("textAlign","right");
				rowItem_preClassTime.addElement(preClassTime);
				row1.addElement(rowItem_preClassTime);
				var rowItem_preClassTimes:GridItem=new GridItem();
				var preClassDate:DateField=new DateField();
				preClassDate.formatString="YYYY-MM-DD";
				preClassDate.width=120;
				preClassDate.name="aCourseDate";
				preClassDate.id="aCourseDate";
				var preClassDateMutiCombobox:MyDropList=new MyDropList();
				preClassDateMutiCombobox.width=200;
				preClassDateMutiCombobox.name="aCourseSection";
				preClassDateMutiCombobox.id="aCourseSection";
				preClassDateMutiCombobox.dataProvider=new ArrayCollection(courseSections.toArray());
				rowItem_preClassTimes.addElement(preClassDate);
				rowItem_preClassTimes.addElement(preClassDateMutiCombobox);
				row1.addElement(rowItem_preClassTimes);
				
			
				
				var row1Item_add:GridItem=new GridItem();
				var row1Item_removeButton:LinkButton=new LinkButton();
				row1Item_removeButton.label="删除";
				row1Item_removeButton.setStyle("icon", button_delete);
				row1Item_removeButton.owner=row1;//标记删除行
				
				row1Item_removeButton.addEventListener(MouseEvent.CLICK,removeItem_clickHandler);
				row1Item_add.addElement(row1Item_removeButton);
				row1.addElement(row1Item_add);
				container.addElementAt(row1,container.getChildren().length-1);
				
				var row2:GridRow=new GridRow();
				
				var rowItem_adjustTime:GridItem=new GridItem();
				var adjustTime:Label=new Label();
				adjustTime.text="意向时间";
				adjustTime.width=60;
				adjustTime.setStyle("textAlign","right");
				rowItem_adjustTime.addElement(adjustTime);
				row2.addElement(rowItem_adjustTime);
				var rowItem_adjustTimeDate:GridItem=new GridItem();
				var adjustTimeDate:DateField=new DateField();
				adjustTimeDate.formatString="YYYY-MM-DD";
				adjustTimeDate.width=120;
				adjustTimeDate.name="adjustDate";
				adjustTimeDate.id="adjustDate";
				rowItem_adjustTimeDate.addElement(adjustTimeDate);
				row2.addElement(rowItem_adjustTimeDate);
				
				var rowItem_adjustTeacher:GridItem=new GridItem();
				var adjustTeacher:Label=new Label();
				adjustTeacher.text="意向老师";
				adjustTeacher.width=60;
				adjustTeacher.setStyle("textAlign","right");
				rowItem_adjustTeacher.addElement(adjustTeacher);
				row2.addElement(rowItem_adjustTeacher);
				
				var rowItem_adjustTeacherInput:GridItem=new GridItem();
				var adjustTeacherInput:AutoComplete=new AutoComplete();
				adjustTeacherInput.width=120;
				adjustTeacherInput.name="adjustTeacher";
				adjustTeacherInput.id="adjustTeacher";
				adjustTeacherInput.IsfocusInDropDown=true;
				adjustTeacherInput.IsAutoComplete=true;
				rowItem_adjustTeacherInput.addElement(adjustTeacherInput);
				row2.addElement(rowItem_adjustTeacherInput);

				
				var row2Item_empty:GridItem=new GridItem();
				row2Item_empty.colSpan=2;
				row2.addElement(row2Item_empty);
				row1.owner=row2;//标记删除行的下一行
				
				container.addElementAt(row2,container.getChildren().length-1);
				container.validateNow();
			
			}


			protected function courseSection_changeHandler(event:ListEvent):void
			{
//				courseSectionSelect.text="";
//				for each(var item:int in courseSection.selectedIndices){
//					if(courseSection.selectedItems[item].selected==true)
//					courseSectionSelect.text+=courseSection.selectedItems[item].label+";";
//				}
			}


			protected function save_clickHandler(event:MouseEvent):void
			{
//				Alert.show(container.toString());
				var validatorErrorArray:Array = Validator.validateAll(validatorArr);;
				var isValidForm:Boolean = validatorErrorArray.length == 0;
				if (isValidForm) {
					
				} else {
					var err:ValidationResultEvent;
					var errorMessageArray:Array = [];
					for each (err in validatorErrorArray) {
						var errField:String = FormItem(err.currentTarget.source.parent).label
						errorMessageArray.push(errField + ": " + err.message);
					}
					Alert.show(errorMessageArray.join("\n\n"), "请按照以下错误提示信息重新填写", Alert.OK);
				}
			}

		]]> 		
	</mx:Script> 

	<mx:Panel width="100%" height="100%"   title="调课申请"  borderVisible="false" id="panel" dropShadowVisible="false">
		<mx:VBox width="100%" height="100%" id="listPanel">
			<mx:HBox verticalAlign="middle" horizontalAlign="right" width="100%" fontSize="12" >
				<mx:HBox width="100%" height="30" paddingLeft="20"  horizontalGap="0" backgroundColor="#C5E497"  verticalAlign="middle">
					<mx:Label text="|"/>
					<mx:LinkButton  label="添加" icon="@Embed(source='../WebContent/resources/common/tools/button_add_icon.png')" click=" this.currentState='add'" />
					<mx:Label text="|"/>
				</mx:HBox>
			</mx:HBox>
			<mx:VBox width="100%" height="100%"  verticalGap="10" verticalAlign="middle" horizontalAlign="center" >
				
				<mx:HBox width="100%" height="100%" paddingLeft="10" paddingRight="10" paddingBottom="10">
					<mx:Panel width="100%" height="100%"  styleName="customPanel" title="申请记录"  cornerRadius="5" borderVisible="false" dropShadowVisible="false">
						
						<component:WlzxPageDataGrid width="100%" height="100%" borderVisible="false"   borderAlpha="0.2" verticalAlign="middle"   id="accountTable" pagecount="10"  >				
							<component:mygridcolumns>
								
								<mx:DataGridColumn textAlign="center" headerText="申请时间" dataField="name" width="100">
								</mx:DataGridColumn>
								<mx:DataGridColumn textAlign="center" headerText="申请类型" dataField="email" width="170">
									
								</mx:DataGridColumn>
								
								<mx:DataGridColumn textAlign="center" headerText="班级" dataField="creationDate" width="120">
								
								</mx:DataGridColumn>
								<mx:DataGridColumn textAlign="center" headerText="原课时" dataField="creationDate" width="120">
									
								</mx:DataGridColumn>
								<mx:DataGridColumn textAlign="center" headerText="新课时" dataField="creationDate" width="120">
									
								</mx:DataGridColumn>
								<mx:DataGridColumn textAlign="center" headerText="代课老师" dataField="creationDate" width="120">
									
								</mx:DataGridColumn>
								<mx:DataGridColumn textAlign="center" headerText="编辑" width="60">
									<mx:itemRenderer>
										<mx:Component>
											<mx:LinkButton  label="[编辑]"   click="{this.outerDocument.enterEdit(data.id);}">											
											</mx:LinkButton>										
										</mx:Component>
									</mx:itemRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn textAlign="center" headerText="取消"  width="60">
									<mx:itemRenderer>
										<mx:Component>
											<mx:LinkButton  label="[取消]"   click="{this.outerDocument.cancleApply(data.id);}">											
											</mx:LinkButton>										
										</mx:Component>
									</mx:itemRenderer>
								</mx:DataGridColumn>
								<mx:DataGridColumn textAlign="center" headerText="详细"  width="60">
									<mx:itemRenderer>
										<mx:Component>
											<mx:LinkButton  label="[详细]"   click="{this.outerDocument.detailApply(data.id);}">											
											</mx:LinkButton>										
										</mx:Component>
									</mx:itemRenderer>
								</mx:DataGridColumn>
							</component:mygridcolumns>
						</component:WlzxPageDataGrid>
					</mx:Panel>
				</mx:HBox>
				
			</mx:VBox>
		</mx:VBox>
		<mx:VBox width="100%" height="100%" id="addPanel">
			<mx:HBox verticalAlign="middle" horizontalAlign="right" width="100%" fontSize="12">
				<mx:HBox width="100%" height="30" paddingLeft="20"  horizontalGap="0" backgroundColor="#C5E497"  verticalAlign="middle">
					<mx:Label text="|"/>
					<mx:LinkButton  label="返回" icon="@Embed(source='../WebContent/resources/common/tools/button_back_icon.png')" click="currentState='list';" />
					<mx:Label text="|"/>
				</mx:HBox>
			</mx:HBox>
			<mx:VBox width="100%" height="50%"   horizontalGap="10" verticalAlign="middle" horizontalAlign="left" borderVisible="true" paddingTop="10" paddingBottom="10"   paddingLeft="10" paddingRight="10">
				<mx:HBox width="100%" horizontalAlign="center">
					<mx:Label  text="调课申请单"   width="100%"  letterSpacing="5" textAlign="center" fontSize="14"  fontWeight="bold" height="30" />
				</mx:HBox>
				
				<mx:VBox width="100%" horizontalAlign="center" height="100%" verticalAlign="middle"   borderVisible="true" paddingLeft="20" paddingRight="20">
					
					<mx:Grid width="80%" height="100%" id="container"  verticalGap="10" horizontalGap="5"   borderStyle="solid" paddingBottom="10" paddingTop="10" paddingLeft="10" paddingRight="10">
						
						<mx:GridRow width="100%" height="30" >
							<mx:GridItem  borderStyle="none"  verticalAlign="bottom" horizontalAlign="right"  colSpan="3">
								
								<mx:Label  text="申请类型"   textAlign="right" />
								<mx:ComboBox id="applyType"  selectedIndex="0"  editable="false" width="60"/>
							</mx:GridItem>
							<mx:GridItem  borderStyle="none"  verticalAlign="bottom" horizontalAlign="left" colSpan="2">
								
								<mx:Label  text="申请人"  textAlign="right"/>
								<mx:TextInput width="120"   alpha="0.5"/>
							</mx:GridItem>
							
							
							<mx:GridItem  borderStyle="none"  verticalAlign="bottom" horizontalAlign="left" colSpan="2">
								
								<mx:Label  text="申请时间"  textAlign="right"/>
								<mx:Label  text="{CommonUtils.formatDate(new Date())}"  textAlign="left"/>
							</mx:GridItem>
							
						</mx:GridRow>
						<mx:GridRow width="100%" height="10" >
							<mx:GridItem  borderStyle="none"  verticalAlign="middle" horizontalAlign="right" colSpan="7">
								<mx:HRule  width="98%" />
							</mx:GridItem>
						</mx:GridRow>
						<mx:GridRow width="100%" height="30"  >
							
							<mx:GridItem    verticalAlign="middle" horizontalAlign="right">
								
								<mx:Label  text="班级" width="60"  textAlign="right" />
								
							</mx:GridItem>
							
							<mx:GridItem  verticalAlign="middle" horizontalAlign="center" >
								
								<mx:TextInput width="120" name="aClass" id="aClass"/>
								
							</mx:GridItem>
							<mx:GridItem    verticalAlign="middle" horizontalAlign="left">
								
								<mx:Label  text="科目" width="60"  textAlign="right"/>
								
							</mx:GridItem>
							
							<mx:GridItem    verticalAlign="middle" horizontalAlign="center">
								
								<mx:ComboBox id="aCourse"  selectedIndex="0"   prompt="请选择" editable="false" width="120"  name="aCourse" dataProvider="{courseTypes}"/>
								
							</mx:GridItem>
							<mx:GridItem   verticalAlign="middle" horizontalAlign="left">
								
								<mx:Label  text="原课时" width="60"  textAlign="right"/>
								
							</mx:GridItem>
							
							<mx:GridItem  verticalAlign="middle" horizontalAlign="center">
								
								<mx:DateField width="120" formatString="YYYY-MM-DD"  name="aCourseDate" id="aCourseDate"/>
								<mutiComboBox:MyDropList width="200"    dataProvider="{new ArrayCollection(courseSections.toArray())}" name="aCourseSection" id="aCourseSection"/>
								
							</mx:GridItem>
							
							<mx:GridItem  rowSpan="2"  verticalAlign="middle" horizontalAlign="center">
								<mx:LinkButton  label="添加" icon="{button_add}"  click="addItem_clickHandler(event)" />

							</mx:GridItem>
							
						</mx:GridRow>
						<mx:GridRow width="100%" height="30">
							<mx:GridItem   verticalAlign="middle" horizontalAlign="left">
								<mx:Label  text="意向时间" width="60"  textAlign="right"/>
								
							</mx:GridItem>
							<mx:GridItem  verticalAlign="middle" horizontalAlign="center">
								<mx:DateField width="120" formatString="YYYY-MM-DD" name="adjustDate" id="adjustDate"/>
								
							</mx:GridItem>
							<mx:GridItem   verticalAlign="middle" horizontalAlign="left">
								<mx:Label  text="意向老师" width="60"  textAlign="right"/>
								
							</mx:GridItem>
							<mx:GridItem    verticalAlign="middle" horizontalAlign="center">
								<component:AutoComplete id="adjustTeacher" width="120" IsfocusInDropDown="true"  IsAutoComplete="true"  name="adjustTeacher">
									
								</component:AutoComplete>
							</mx:GridItem>
							<mx:GridItem     colSpan="2" verticalAlign="middle" horizontalAlign="center">
								
							</mx:GridItem>
						</mx:GridRow>
						<mx:GridRow width="100%">
							<mx:GridItem    verticalAlign="middle" horizontalAlign="center">
								<mx:Label  text="事由" width="60"  textAlign="right"/>
							</mx:GridItem>
							<mx:GridItem    verticalAlign="middle"  colSpan="5" horizontalAlign="center">
								<mx:TextArea width="100%" height="100"/>
							</mx:GridItem>
							<mx:GridItem     verticalAlign="middle" horizontalAlign="center">
								
							</mx:GridItem>
						</mx:GridRow>
					</mx:Grid>
					
					<mx:HBox width="100%"  horizontalAlign="right">
						<mx:Button label="保存" width="60" click="save_clickHandler(event)"/>
					</mx:HBox>
				</mx:VBox>
				
				
				
			</mx:VBox>
		</mx:VBox>
		
	</mx:Panel>
</mx:Module>
