<?xml version="1.0" encoding="utf-8"?>
<mx:Module xmlns:fx="http://ns.adobe.com/mxml/2009" 
		   xmlns:s="library://ns.adobe.com/flex/spark" 
		   xmlns:mx="library://ns.adobe.com/flex/mx" xmlns:valueObjects="basic.entity.*" xmlns:mutiComboBox="system.component.mutiComboBox.*" xmlns:component="system.component.*" layout="vertical" width="100%" height="100%" creationComplete="init();">
	<mx:states>
		<mx:State name="list">           
		</mx:State>
		<mx:State name="add">           
		</mx:State>
	</mx:states>
	<mx:transitions>
		
		<mx:Transition id="myTransition1" fromState="list" toState="add" >
			
			<mx:Parallel id="t1" target="{work_experience_addPanel}" >
				
				<mx:WipeLeft duration="800">
					
				</mx:WipeLeft>
			</mx:Parallel>
			
			
		</mx:Transition>
		<mx:Transition id="myTransition2" fromState="add" toState="list" >
			
			<mx:Parallel id="t2" target="{work_experience_listPanel}" >
				
				<mx:WipeRight duration="800">
					
				</mx:WipeRight>
			</mx:Parallel>
			
			
		</mx:Transition>
		
		
	</mx:transitions>
	<fx:Script>
		<![CDATA[
			import basic.entity.*;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.events.ValidationResultEvent;
			import mx.formatters.DateFormatter;
			import mx.rpc.events.*;
			import mx.validators.Validator;
			
			import system.utils.CommonUtils;
			
			private var validatorArr:Array;
			private var createDate:Date;
			private var modifiedDate:Date;
			private var style:int;
			private var teacherId:String;
			private var userID:String;
			
			public var sexArr:ArrayCollection = new ArrayCollection(
				[    
					{value:"0", name:"男"}, 
					{value:"1", name:"女"}
				]                
			);
			public var marriageArr:ArrayCollection = new ArrayCollection(
				[    
					{value:"0", name:"未婚"}, 
					{value:"1", name:"已婚"}
				]                
			);
			
			public var politicArr:ArrayCollection = new ArrayCollection(
				[    
					{value:"0", name:"党员"}, 
					{value:"1", name:"团员"},
					{value:"2", name:"其他"}
				]                
			);
			
			public var educationArr:ArrayCollection = new ArrayCollection(
				[    
					{value:"0", name:"本科"}, 
					{value:"1", name:"高中"},
					{value:"2", name:"大专"}
				]                
			);
			
			public var departmentArr:ArrayCollection = new ArrayCollection(
				[    
					{value:"0", name:"教务处"}, 
					{value:"1", name:"其他"}
				]                
			);
			
			public var statusArr:ArrayCollection = new ArrayCollection(
				[    
					{value:"0", name:"正式"}, 
					{value:"1", name:"适用"},
					{value:"2", name:"离职"},
					{value:"3", name:"离休"}
				]                
			);

			
			private function init():void
			{
				validatorArr = new Array();
				validatorArr.push(name_stringValidator);
				validatorArr.push(birthday_dateValidator);
				validatorArr.push(nation_stringValidator);
				//validatorArr.push(idCode_stringValidator);
				validatorArr.push(nativePlace_stringValidator);
				//validatorArr.push(department_stringValidator);
				validatorArr.push(position_stringValidator);
				//validatorArr.push(cellphone_phoneNumberValidator);
				//validatorArr.push(homephone_phoneNumberValidator);
				callLater(initStaffWin);
			}
			
			private function initStaffWin():void{
				if(this.toolTip=='Update'){		
					//var departmentId:String=this.id;//弹出窗口时设定的中转参数
					//systemServiceRO.getDepartmentById(departmentId);
				}else{
					teacher = new TeacherModel();
					//var parentId:String=this.id;//弹出窗口时设定的中转参数
					//systemServiceRO.getDepartmentById(parentId);
				}
			}
			
			protected function validateForm(event:MouseEvent):void
			{
				
				var validatorErrorArray:Array = Validator.validateAll(validatorArr);
				var isValidForm:Boolean = validatorErrorArray.length == 0;
				if (isValidForm) {
					teacher.name = teacherName.text;
					teacher.teacherMail = mail.text;
					teacher.teacherNo = teacherno.text;
					teacher.sex = parseInt(sex.selectedItem.value);
					teacher.birthday = DateFormatter.parseDateString(birthday.text);
					teacher.teacherMarried = parseInt(marriage.selectedItem.value);
					teacher.nation = nation.text;
					teacher.politicsStatus = parseInt(politicStatus.selectedItem.value);
					teacher.teacherID = idCode.text;
					teacher.teacherNativePlace = nativePlace.text;
					teacher.homePhone = homePhone.text;
					teacher.teacherMobilePhone = cellPhone.text;
					teacher.teacherEducation = education.selectedItem.value;
					teacher.teacherProfession = profession.text;
					teacher.teacherGraduateSchool = school.text;
					teacher.teacherProfessionTitle = professionalTitle.text;
					teacher.teacherSkillLevel = skillLevel.text;
					teacher.teacherSkillLevelDate = DateFormatter.parseDateString(skillLevelDate.text);
					teacher.teacherDepartment = department.selectedItem.value;
					teacher.teacherPosition = position.text;
					teacher.teacherContactPhone = contactPhone.text;
					teacher.teacherOfficePhone = officePhone.text;
					teacher.teacherWorkDate = DateFormatter.parseDateString(workDate.text);
					teacher.teacherAddress = teacherAddress.text;
					
					//teacher.teacherPhoto = status.text;
					teacher.teacherStatus = parseInt(status.selectedItem.value);
					teacher.teacherAttendDate = DateFormatter.parseDateString(attendDate.text);
					
					teacher.creationDate = createDate;
					teacher.modifiedDate = modifiedDate;
					teacher.style = style;
					teacher.id = teacherId;
					teacher.userID = userID;
					//Alert.show("添加");
					teacherServiceRO.save(teacher);
				} else {
					var err:ValidationResultEvent;
					var errorMessageArray:Array = [];
					for each (err in validatorErrorArray) {
						var errField:String = FormItem(err.currentTarget.source.parent).label
						errorMessageArray.push(errField + ": " + err.message);
					}
					Alert.show(errorMessageArray.join("\n\n"), "请按照以下错误提示信息重新填写", Alert.OK);
				}
			}
			
			protected function systemFaultHandler(event:FaultEvent):void {
				Alert.show(event.fault.faultString, 'Error');
			}
			
			protected function teacherAddResult_resultHandler(event:ResultEvent):void
			{
				var teacher:Object=event.result;
				if(teacher!=null){
					createDate = teacher.creationDate;
					modifiedDate = teacher.modifiedDate;
					style = teacher.style;
					teacherId = teacher.id;
					userID = teacher.userID;
					Alert.show("添加成功");
				}else{
					Alert.show("添加失败");
				}
			}

			protected function teacherno_focusOutHandler(event:FocusEvent):void
			{
				// TODO Auto-generated method stub
			}
			
			public const courseSections:ArrayCollection = new ArrayCollection([{label:"全选",value:"all",selected:false},
				{label:"第一节",value:"1",selected:false},
				{label:"第二节",value:"2",selected:false},
				{label:"第三节",value:"3",selected:false},
				{label:"第四节",value:"4",selected:false},
				{label:"第五节",value:"5",selected:false},
				{label:"第六节",value:"6",selected:false},
				{label:"第七节",value:"7",selected:false},
				{label:"第八节",value:"8",selected:false},
				{label:"第九节",value:"9",selected:false}
				
			]);
			
			private const button_add:Class;
			
			public function cancleApply(id:String):void{
				
			}
			public function enterEdit(id:String):void{
				
			}
			
			protected function addItem_clickHandler(event:MouseEvent):void
			{
				
			}
			
			protected function save_clickHandler(event:MouseEvent):void
			{
				
			}

		]]>
	</fx:Script>

	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
		<mx:StringValidator id="name_stringValidator" source="{teacherName}" property="text"  requiredFieldError="不能为空"/>
		<mx:DateValidator id="birthday_dateValidator" inputFormat="YYYY-MM-DD" source="{birthday}" property="text"  requiredFieldError="请选择"/>
		<mx:StringValidator id="nation_stringValidator" source="{nation}" property="text"  requiredFieldError="不能为空"/>
		<mx:RegExpValidator id="idCode_stringValidator" expression="^[0-9]\{18\}[\w]?$" noMatchError="格式错误" source="{idCode}" property="text"  requiredFieldError="不能为空"/>
		<mx:StringValidator id="nativePlace_stringValidator" source="{nativePlace}" property="text"  requiredFieldError="不能为空"/>
		<mx:StringValidator id="position_stringValidator" source="{position}" property="text"  requiredFieldError="不能为空"/>
		<mx:PhoneNumberValidator id="cellphone_phoneNumberValidator" source="{cellPhone}" property="text" minDigits="6" requiredFieldError="错误格式的电话"/>
		<mx:PhoneNumberValidator id="homephone_phoneNumberValidator" source="{homePhone}" required="false" property="text" minDigits="6" requiredFieldError="错误格式的电话"/>
		<mx:DateValidator id="work_dateValidator" inputFormat="YYYY-MM-DD" source="{workDate}" property="text"  requiredFieldError="请选择"/>
		<mx:DateValidator id="attend_dateValidator" inputFormat="YYYY-MM-DD" source="{attendDate}" property="text"  requiredFieldError="请选择"/>
		<valueObjects:TeacherModel id="teacher"/>
		<mx:RemoteObject id="teacherServiceRO" destination="teacherServiceDest" showBusyCursor="true" fault="systemFaultHandler(event);">
			<mx:method name="save"  concurrency="last"  result="teacherAddResult_resultHandler(event);" />
		</mx:RemoteObject>
		<mx:HTTPService id="teacherNoValidate" url="/servlet/teacherNoValidate" showBusyCursor="true" method="POST">  
		</mx:HTTPService> 
	</fx:Declarations>
	<s:Panel width="100%" height="100%" title="教师信息编辑"  styleName="customPanel"   borderVisible="true" dropShadowVisible="false">
		<s:VGroup width="100%" height="100%">
			<mx:TabNavigator id="systems"  width="100%" height="100%" tabStyleName="customTabStyles"  horizontalGap="1" borderVisible="false"  tabWidth="120" paddingTop="0">
				<s:NavigatorContent label="基础信息">
					<s:layout>
						<s:VerticalLayout/>
					</s:layout>
					<mx:Form width="100%" height="100%" textAlign="left" labelWidth="70">
						<s:HGroup width="100%" height="40%" >
							<s:VGroup width="10%" height="100%">
								<s:Label>
									<s:text>基本信息</s:text>
								</s:Label>
							</s:VGroup>
							<s:VGroup width="40%" height="100%">
								<s:HGroup width="100%">
									<mx:FormItem label="姓名" width="50%">
										<s:TextInput id="teacherName" width="100%"/>
									</mx:FormItem>
									<mx:FormItem label="性别" width="50%">
										<s:DropDownList 
											id="sex" 
											selectedIndex="0" 
											width="100%"
											dataProvider="{sexArr}" 
											labelField="name"/> 
									</mx:FormItem>
								</s:HGroup>
								<s:HGroup width="100%">
									<mx:FormItem label="婚姻状况" width="50%">
										<s:DropDownList 
											id="marriage" 
											width="100%" 
											selectedIndex="0" 
											dataProvider="{marriageArr}" 
											labelField="name"/>
									</mx:FormItem>
									<mx:FormItem label="民族" width="50%">
										<mx:TextInput id="nation" width="100%"/>
									</mx:FormItem>
								</s:HGroup>
								<mx:FormItem label="身份证号" width="100%">
									<mx:TextInput id="idCode" width="100%"/>
								</mx:FormItem>
								<mx:FormItem label="邮箱" width="100%">
									<mx:TextInput id="mail" width="100%"/>
								</mx:FormItem>
								<mx:FormItem label="家庭地址" width="100%">
									<mx:TextInput id="teacherAddress" width="100%"/>
								</mx:FormItem>
							</s:VGroup>
							<s:VGroup width="30%">
								<s:HGroup width="100%">
									<mx:FormItem label="出生年月" width="100%">
										<mx:DateField id="birthday" width="100%" yearNavigationEnabled="true" formatString="YYYY-MM-DD"/>
									</mx:FormItem>
								</s:HGroup>
								<mx:FormItem label="政治面貌" width="100%">
									<s:DropDownList 
										id="politicStatus" 
										width="100%" dataProvider="{politicArr}"
										selectedIndex="0" 
										labelField="name"/> 
								</mx:FormItem>
								<mx:FormItem label="籍贯" width="100%">
									<mx:TextInput id="nativePlace" width="100%"/>
								</mx:FormItem>
								<mx:FormItem label="家庭电话" width="100%">
									<mx:TextInput id="homePhone" width="100%"/>
								</mx:FormItem>
								<mx:FormItem label="手机" width="100%">
									<mx:TextInput id="cellPhone" width="100%"/>
								</mx:FormItem>
							</s:VGroup>
							<s:VGroup width="20%">
								<mx:FormItem label="照片" width="100%" height="200%">
									<mx:Image/>
								</mx:FormItem>
								<mx:FormItem label="短号" width="100%">
									<mx:TextInput id="teacherno" width="100%" focusOut="teacherno_focusOutHandler(event)"/>
								</mx:FormItem>
							</s:VGroup>
						</s:HGroup>
						<s:HGroup width="100%" height="20%">
							<s:VGroup width="10%" height="100%">
								<s:Label>
									<s:text>教育背景</s:text>
								</s:Label>
							</s:VGroup>
							<s:VGroup width="20%">
								<mx:FormItem label="学历" width="100%">
									<s:ComboBox 
										id="education" 
										width="100%" 
										selectedIndex="0" 
										dataProvider="{educationArr}" 
										labelField="name"/>
								</mx:FormItem>
								<mx:FormItem label="职称" width="100%">
									<mx:TextInput id='professionalTitle' width="100%"/>
								</mx:FormItem>
							</s:VGroup>
							<s:VGroup width="30%">
								<mx:FormItem label="专业" width="100%">
									<mx:TextInput id='profession' width="100%"/>
								</mx:FormItem>
								<mx:FormItem label="技能等级" width="100%">
									<mx:TextInput id='skillLevel' width="100%"/>
								</mx:FormItem>
							</s:VGroup>
							<s:VGroup width="50%">
								<mx:FormItem label="毕业院校" width="100%">
									<mx:TextInput id='school'/>
								</mx:FormItem>
								<mx:FormItem label="技能鉴定时间" width="100%">
									<mx:DateField id="skillLevelDate" width="100%"/>
								</mx:FormItem>
							</s:VGroup>
						</s:HGroup>
						<s:HGroup width="100%">
							<s:VGroup width="10%" height="100%">
								<s:Label>
									<s:text>温中聘请信息</s:text>
								</s:Label>
							</s:VGroup>
							<s:VGroup width="100%">
								<s:HGroup width="100%">
									<mx:FormItem label="部门" width="20%">
										<s:ComboBox 
											id="department" 
											width="100%" 
											selectedIndex="0" 
											dataProvider="{departmentArr}" 
											labelField="name"/>
									</mx:FormItem>
									<mx:FormItem label="职务" width="30%">
										<mx:TextInput id='position' width="100%"/>
									</mx:FormItem>
									<mx:FormItem label="办公电话" width="50%">
										<mx:TextInput id='officePhone' width="100%"/>
									</mx:FormItem>
								</s:HGroup>
								<s:HGroup width="100%">
									<mx:FormItem label="紧要联络电话" width="20%">
										<mx:TextInput id='contactPhone' width="100%"/>
									</mx:FormItem>
									<mx:FormItem label="何时工作" width="30%">
										<mx:DateField id='workDate' width="100%" formatString="YYYY-MM-DD"/>
									</mx:FormItem>
									<mx:FormItem label="工龄" width="50%">
										<mx:TextInput id='workPeriod' width="100%"/>
									</mx:FormItem>
								</s:HGroup>
								<s:HGroup width="100%">
									<mx:FormItem label="入校时间" width="20%">
										<mx:DateField id="attendDate" width="100%" formatString="YYYY-MM-DD"/>
									</mx:FormItem>
									<mx:FormItem label="校龄" width="30%">
										<mx:TextInput id='attendPeriod' width="100%"/>
									</mx:FormItem>
									<mx:FormItem label="状态" width="20%">
										<s:DropDownList id='status' width="100%" 
														dataProvider="{educationArr}" 
														labelField="name" selectedIndex="0"/>
									</mx:FormItem>
									<s:Button click="validateForm(event)" label="保存"/>
								</s:HGroup>
								<s:HGroup width="100%">
									<s:Label width="8%" height="30" verticalAlign="middle">
										<s:text>其他部门</s:text>
									</s:Label>
									<s:Button label="增加"/>
									<s:VGroup>
										
									</s:VGroup>
								</s:HGroup>
							</s:VGroup>
						</s:HGroup>
					</mx:Form>
				</s:NavigatorContent>
				<s:NavigatorContent label="其他信息">
					<s:layout>
						<s:VerticalLayout/>
					</s:layout>
					<s:VGroup width="100%">
						<s:HGroup width="100%" height="50%">
							<s:Panel width="100%" height="100%" title="工作经历"  borderVisible="false" id="work_experience" dropShadowVisible="false">
								<s:VGroup width="100%" height="100%" id="work_experience_listPanel">
									<s:HGroup verticalAlign="middle" horizontalAlign="right" width="100%" fontSize="12" height="30" paddingLeft="20">
										<s:Label text="|"/>
										<mx:LinkButton  label="添加" icon="@Embed(source='../WebContent/resources/common/tools/button_add_icon.png')" click=" this.currentState='add'" />
										<s:Label text="|"/>
									</s:HGroup>
									<s:VGroup width="100%" height="100%"  gap="10" verticalAlign="middle" horizontalAlign="center">
										<s:HGroup width="100%" height="100%" paddingLeft="10" paddingRight="10" paddingBottom="10">
											<s:Panel width="100%" height="100%"  styleName="customPanel" title="工作记录"  cornerRadius="5" borderVisible="false" dropShadowVisible="false">
												<component:WlzxPageDataGrid width="100%" height="100%" borderVisible="false"   borderAlpha="0.2" verticalAlign="middle"   id="accountTable" pagecount="10"  >				
													<component:mygridcolumns>
														
														<mx:DataGridColumn textAlign="center" headerText="开始时间" dataField="name" width="100">
														</mx:DataGridColumn>
														<mx:DataGridColumn textAlign="center" headerText="截止时间" dataField="email" width="170">
															
														</mx:DataGridColumn>
														
														<mx:DataGridColumn textAlign="center" headerText="工作单位" dataField="creationDate" width="120">
															
														</mx:DataGridColumn>
														<mx:DataGridColumn textAlign="center" headerText="职务" dataField="creationDate" width="120">
															
														</mx:DataGridColumn>
														<mx:DataGridColumn textAlign="center" headerText="编辑" width="60">
															<mx:itemRenderer>
																<fx:Component>
																	<mx:LinkButton  label="[编辑]"   click="{this.outerDocument.enterEdit(data.id);}">											
																	</mx:LinkButton>										
																</fx:Component>
															</mx:itemRenderer>
														</mx:DataGridColumn>
														<mx:DataGridColumn textAlign="center" headerText="取消"  width="60">
															<mx:itemRenderer>
																<fx:Component>
																	<mx:LinkButton  label="[取消]"   click="{this.outerDocument.cancleApply(data.id);}">											
																	</mx:LinkButton>										
																</fx:Component>
															</mx:itemRenderer>
														</mx:DataGridColumn>
													</component:mygridcolumns>
												</component:WlzxPageDataGrid>
											</s:Panel>
										</s:HGroup>
									</s:VGroup>
								</s:VGroup>
								<s:VGroup width="100%" height="100%" id="work_experience_addPanel">
									<s:HGroup verticalAlign="middle" horizontalAlign="right" width="100%" fontSize="12">
										<s:HGroup width="100%" height="30" paddingLeft="20"  gap="0"  verticalAlign="middle">
											<s:Label text="|"/>
											<mx:LinkButton  label="返回" icon="@Embed(source='../WebContent/resources/common/tools/button_back_icon.png')" click="currentState='list';" />
											<s:Label text="|"/>
										</s:HGroup>
									</s:HGroup>
									<s:VGroup width="100%" height="50%" gap="10" verticalAlign="middle" horizontalAlign="left" paddingTop="10" paddingBottom="10"   paddingLeft="10" paddingRight="10">
										<s:HGroup width="100%" horizontalAlign="center">
											<s:Label  text="调课申请单" width="100%"  textAlign="center" fontSize="14"  fontWeight="bold" height="30" />
										</s:HGroup>
										<s:VGroup width="100%" horizontalAlign="center" height="100%" verticalAlign="middle" paddingLeft="20" paddingRight="20">
											<mx:Grid width="80%" height="100%" id="container"  verticalGap="10" horizontalGap="5"   borderStyle="solid" paddingBottom="10" paddingTop="10" paddingLeft="10" paddingRight="10">
												
												<mx:GridRow width="100%" height="30" >
													<mx:GridItem  borderStyle="none"  verticalAlign="bottom" horizontalAlign="left" colSpan="2">
														
														<mx:Label  text="申请时间"  textAlign="right"/>
														<mx:Label  text="{CommonUtils.formatDate(new Date())}"  textAlign="left"/>
													</mx:GridItem>
													<mx:GridItem  borderStyle="none"  verticalAlign="bottom" horizontalAlign="left" colSpan="2">
														
														<mx:Label  text="截止时间"  textAlign="right"/>
														<mx:Label  text="{CommonUtils.formatDate(new Date())}"  textAlign="left"/>
													</mx:GridItem>
													
												</mx:GridRow>
												<mx:GridRow width="100%" height="10" >
													<mx:GridItem  borderStyle="none"  verticalAlign="middle" horizontalAlign="right" colSpan="7">
														<mx:HRule  width="98%" />
													</mx:GridItem>
												</mx:GridRow>
												<mx:GridRow width="100%" height="30"  >
													
													<mx:GridItem    verticalAlign="middle" horizontalAlign="right">
														
														<mx:Label  text="工作单位" width="60"  textAlign="right" />
														
													</mx:GridItem>
													
													<mx:GridItem  verticalAlign="middle" horizontalAlign="center" >
														
														<mx:TextInput width="120" name="aClass" id="aClass"/>
														
													</mx:GridItem>
													<mx:GridItem    verticalAlign="middle" horizontalAlign="left">
														
														<mx:Label  text="职务" width="60"  textAlign="right"/>
														
													</mx:GridItem>
													
													<mx:GridItem  verticalAlign="middle" horizontalAlign="center">
														
														<mx:DateField width="120" formatString="YYYY-MM-DD"  name="aCourseDate" id="aCourseDate"/>
														<mutiComboBox:MyDropList width="200"    dataProvider="{new ArrayCollection(courseSections.toArray())}" name="aCourseSection" id="aCourseSection"/>
														
													</mx:GridItem>
													
													<mx:GridItem  rowSpan="2"  verticalAlign="middle" horizontalAlign="center">
														<mx:LinkButton  label="添加" icon="{button_add}"  click="addItem_clickHandler(event)" />
														
													</mx:GridItem>
													
												</mx:GridRow>
											</mx:Grid>
											<mx:HBox width="100%"  horizontalAlign="right">
												<mx:Button label="保存" width="60" click="save_clickHandler(event)"/>
											</mx:HBox>
										</s:VGroup>
									</s:VGroup>
								</s:VGroup>
							</s:Panel>
						</s:HGroup>
					</s:VGroup>
				</s:NavigatorContent>
			</mx:TabNavigator>
		</s:VGroup>
	</s:Panel>
</mx:Module>
