<?xml version="1.0" encoding="utf-8"?>
<mx:Module xmlns:mx="http://www.adobe.com/2006/mxml"  layout="vertical" creationComplete="init();" width="100%" height="100%"
		   xmlns:sendingFiles="oa.sendingFiles.component.*"   currentState="list" backgroundColor="white">
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
		<mx:RemoteObject id="sendingFileServiceRO" destination="sendingFileServiceDest" showBusyCursor="true" fault="systemFaultHandler(event);">
			<mx:method name="getByConditions"  concurrency="last" result="getByConditions_resultHandler(event);"/>
		</mx:RemoteObject>
	
	<mx:states>
		<mx:State name="list">           
			<mx:RemoveChild target="{editPanel}"/>
		</mx:State>
		<mx:State name="add">           
			<mx:RemoveChild target="{listPanel}"/>
		</mx:State>
		
		
	</mx:states>
	<mx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			private function init():void
			{
				//this.addEventListener(Event.REMOVED_FROM_STAGE,function():void{documentMaintain.documentMaintainPart1.dispatchEvent(new Event(FlexEvent.HIDE));});
				search();
			}
			private function systemFaultHandler(event:FaultEvent):void {
				Alert.show(event.fault.faultString, 'Error');
			}
			
			private function getByConditions_resultHandler(event:ResultEvent):void
			{
				if(event.result!=null){
					var allList:ArrayCollection=event.result as ArrayCollection;
					draft_grid.grid.initdata(allList);
				}
			}
			public function search():void
			{
				var dispatchWord:String = search_panel.search_word.text;
				var dispatchYear:String = search_panel.search_year.text;
				var dispatchNumber:String = search_panel.search_num.text;
				var title:String = search_panel.search_title.text;
				var auspiceDepartment:String = search_panel.search_title.text;
				var beginDate:String = search_panel.search_date_begin.text;
				var endDate:String = search_panel.search_date_end.text;
				var states:String = "";
				sendingFileServiceRO.getByConditions( dispatchWord, dispatchYear, dispatchNumber, title, auspiceDepartment, beginDate, endDate, states);

			}
			

			public function add(id:String):void
			{
				var parent:Object=(Object)(((Object)(this.owner)).owner);
				parent.addTab("add_receipt" + id,"正文登记",parent.nav,"oa/receipt/registerDetail.swf",null,id);
			}
			
			private function saveDraft():void
			{
				if(documentMaintain.isValid()){
					if(addUpdateFlag.text == "add")
						sendingFileServiceRO.addSendingFile(documentMaintain.sendingFile,documentMaintain.documentMaintainPart2.upload.idList);
					else sendingFileServiceRO.updateSendingFile(documentMaintain.sendingFile,documentMaintain.documentMaintainPart2.upload.addIds,documentMaintain.documentMaintainPart2.upload.removeIds);

				}
			}
			private function postDraft():void
			{
				if(documentMaintain.isValid()){
					//sendingFileServiceRO.addSendingFile(documentMaintain.sendingFile);
					sendingFileServiceRO.changeWorkFlow(documentMaintain.sendingFile.id,"");
					this.currentState='list';
				}
			}
		]]>
	</mx:Script>
	<mx:VBox borderVisible="true" width="100%" height="100%" borderStyle="solid" horizontalAlign="center" verticalAlign="middle">
		<mx:VBox width="100%" height="100%" id="listPanel">
			<mx:HBox verticalAlign="middle" horizontalAlign="right" width="100%" fontSize="12" >
				<mx:HBox width="100%" height="25" paddingLeft="20"  horizontalGap="10" styleName="CustomHBoxStyle"   verticalAlign="middle">
					<mx:Label text="|"/>
					<mx:LinkButton  label="新增" icon="@Embed(source='../WebContent/resources/common/tools/button_add_icon.png')" click="this.currentState='add';documentMaintain.initStep();"/>
					<mx:Label text="|"/>
				</mx:HBox>
			</mx:HBox>
			<mx:VBox width="100%" height="80"  verticalGap="0" verticalAlign="middle" horizontalAlign="center" >
				<mx:VBox width="100%" height="100%"   horizontalGap="10" verticalAlign="middle" horizontalAlign="left" borderVisible="true" paddingTop="0" paddingBottom="0"   paddingLeft="10" paddingRight="10">
					<sendingFiles:searchBox id="search_panel" width="100%" height="100%"/>
				</mx:VBox>
			</mx:VBox>
			<mx:VBox width="100%" height="100%"  verticalAlign="middle" horizontalAlign="center" paddingLeft="10" paddingRight="10" paddingBottom="10" paddingTop="10">
				<sendingFiles:datagrid id="draft_grid"/>
			</mx:VBox>
		</mx:VBox>
		<mx:VBox width="100%" height="100%" id="editPanel">
			<mx:HBox width="100%" height="25" paddingLeft="20"  horizontalGap="10" styleName="CustomHBoxStyle"   verticalAlign="middle">
				<mx:Label text="|"/>
				<mx:LinkButton  label="返回" icon="@Embed(source='../WebContent/resources/common/tools/button_back_icon.png')" click="this.currentState='list';"/>
				<mx:Label id="addUpdateFlag" visible="false" text="add" width="0"/>
				<mx:LinkButton  label="保存" icon="@Embed(source='../WebContent/resources/common/tools/button_draftSave_icon.png')" click="saveDraft();" />
				<mx:LinkButton  label="拟稿完毕" icon="@Embed(source='../WebContent/resources/common/tools/button_save_icon.png')"  click="postDraft();"/>
				<mx:LinkButton  label="打印" icon="@Embed(source='../WebContent/resources/common/tools/button_printer_icon.png')" />

				<mx:Label text="|"/>
			</mx:HBox>
			<sendingFiles:documentMaintain width="100%" height="100%" id="documentMaintain"/>
		</mx:VBox>
	</mx:VBox>
</mx:Module>

