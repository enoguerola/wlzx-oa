<?xml version="1.0" encoding="utf-8"?>
<s:VGroup xmlns:fx="http://ns.adobe.com/mxml/2009" 
		  xmlns:s="library://ns.adobe.com/flex/spark" 
		  xmlns:mx1="library://ns.adobe.com/flex/mx"
		  xmlns:mx="library://ns.adobe.com/flex/mx"   creationComplete="init();" width="600" height="400">
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
		<mx:RemoteObject id="systemServiceRO" destination="systemServiceDest" showBusyCursor="true" fault="systemFaultHandler(event);">
			<mx:method name="getMessage"  concurrency="last"  result="getMessage_resultHandler(event);" />
		</mx:RemoteObject>
	</fx:Declarations>
	<fx:Script> 
		
		<![CDATA[  
			
			import mx.controls.Alert;
			import mx.events.ValidationResultEvent;
			import mx.formatters.DateFormatter;
			import mx.managers.PopUpManager;
			import mx.rpc.events.*;
			import mx.validators.Validator;
			import mx.validators.ZipCodeValidatorDomainType;
			import mx.collections.ArrayCollection;
			import system.utils.*;
			private var validatorArr:Array;
			
			private function init():void
			{
				callLater(initMessageWin);
			} 
			private function initMessageWin():void{
				var id:String=((Object)(this)).id;
				//Alert.show(id);
				systemServiceRO.getMessage(id);
			}
			protected function systemFaultHandler(event:FaultEvent):void {
				Alert.show(event.fault.faultString, 'Error');
			}
			
			
			protected function getMessage_resultHandler(event:ResultEvent):void
			{
				var message:Object = event.result;
				messageFrom.text=message.fromId=='0'?'系统':parentApplication.getTeacherNameByAccountId(message.fromId);
				messageType.text=message.type==0?'系统消息':'个人消息';
				messageCreationTime.text=CommonUtils.formatDate(message.creationDate as Date);
				messageContent.text=message.content;
				messageTos.text=getMessageTos(message);
			}
		
			public 	 function getMessageTos(data:Object):String{
				if(data!=null){
					var result:String="";
						var toIdsAttr:Array=data.toIds.split(";");
						var readsFlagsAttr=data.readFlags.split(";");
						var readDatesAttr=data.readDates.split(";");
						for(var i:int=0;i<toIdsAttr.length;i++){
							var temp:String=toIdsAttr[i] as String;
							if(temp==null||temp=="")continue;
							var name:String=this.parentApplication.getTeacherNameByAccountId(temp);
							
							result=result.concat(name+"  "+(readsFlagsAttr[i]=='0'?'[未读]':'[已读]')+(readsFlagsAttr[i]=='0'?'':'阅读时间:'+readDatesAttr[i]+'')+"\n");
							
						}
						return result;
					
				}else return null;
			}
		]]> 
		
	</fx:Script> 
	
	<s:TitleWindow  id="messageWin" width="100%" height="100%"   title="消息详细" close="PopUpManager.removePopUp(this);">
		<mx:Form width="100%" height="100%" id="dform">
			<mx:FormItem label="消息类型" width="100%">
				<mx:HBox width="100%">
					<mx:Label text="" id="messageType"/>
				</mx:HBox>
			</mx:FormItem>
			<mx:FormItem label="发送人" width="100%">
				<mx:HBox width="100%">
					<mx:Label text="" id="messageFrom"/>
					<mx:FormItem label="发送时间"></mx:FormItem>
					<mx:Label text="" id="messageCreationTime"/>
				</mx:HBox>
			</mx:FormItem>
			<mx:FormItem label="接收人" width="100%">
				<mx:VBox width="100%">
					<mx1:Text width="100%" id="messageTos" textAlign="left"  minHeight="20"/>
				</mx:VBox>
			</mx:FormItem>
			
			<mx:FormItem label="内容" width="100%">
				<mx:HBox width="100%">
					<mx1:Text id="messageContent" width="500"  minHeight="200">
					</mx1:Text>
				</mx:HBox>
				
			</mx:FormItem>
			
		</mx:Form>
		
	</s:TitleWindow>
	
</s:VGroup>
